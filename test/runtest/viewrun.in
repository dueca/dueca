#!/usr/bin/bash

if [ -z "$1" ]; then
    echo "Supply a control file on the command line."
    exit 1
fi

@NESTSERVER@ @DISPLAY@ -geometry @DISPLAYSIZE@  @NESTEXTRAARGS@ &
NESTSERVERPID=$!
export DISPLAY=@DISPLAY@
export GDK_BACKEND=x11
export -n WAYLAND_DISPLAY

sleep 1
unset DBUS_SESSION_BUS_ADDRESS
LC_ALL=en_US.UTF-8 dbus-launch --exit-with-session @WINDOWMANAGER@-session &
sleep 1
@Python_EXECUTABLE@ @CMAKE_CURRENT_SOURCE_DIR@/testrunner.py \
       --base @TESTRUN_BASE@ \
       --control $1
RESULT=$?
sleep 1

@NESTSERVER_CLEAN@
exit ${RESULT}


